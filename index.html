<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gn-sci</title>
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="stylesheet" href="style.css">

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
    import { 
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { 
      getFirestore, doc, setDoc, getDoc, updateDoc 
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ----------------------------
    // Firebase Config
    // ----------------------------
    const firebaseConfig = {
      apiKey: "AIzaSyDV9R-csa_sdepCy0kt8e8yhZHz77HxY9w",
      authDomain: "gn-sci.firebaseapp.com",
      projectId: "gn-sci",
      storageBucket: "gn-sci.firebasestorage.app",
      messagingSenderId: "415043872292",
      appId: "1:415043872292:web:a9dd0a06270e4f83db1ab1",
      measurementId: "G-HGXJGSGPZC"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ----------------------------
    // DOM References
    // ----------------------------
    const tokenAmountEl = document.getElementById("tokenAmount");
    const tokenDisplay = document.getElementById("tokenDisplay");
    const buyTokensBtn = document.getElementById("buyTokensBtn");
    const buyModal = document.getElementById("buyModal");
    const closeModal = document.getElementById("closeModal");
    const authModal = document.getElementById("authModal");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");

    // ----------------------------
    // AUTH STATE
    // ----------------------------
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const userRef = doc(db, "users", user.uid);
        const userSnap = await getDoc(userRef);

        if (!userSnap.exists()) {
          await setDoc(userRef, { tokens: 0, createdAt: new Date() });
          tokenAmountEl.textContent = 0;
        } else {
          tokenAmountEl.textContent = userSnap.data().tokens;
        }

        tokenDisplay.style.display = "flex";
      } else {
        tokenDisplay.style.display = "none";
      }
    });

    // ----------------------------
    // AUTH FUNCTIONS
    // ----------------------------
    async function signup(email, password) {
      await createUserWithEmailAndPassword(auth, email, password);
    }

    async function login(email, password) {
      await signInWithEmailAndPassword(auth, email, password);
    }

    async function logout() {
      await signOut(auth);
    }

    loginBtn.addEventListener("click", async () => {
      const email = document.getElementById("authEmail").value;
      const password = document.getElementById("authPassword").value;
      await login(email, password);
      authModal.classList.remove("show");
    });

    signupBtn.addEventListener("click", async () => {
      const email = document.getElementById("authEmail").value;
      const password = document.getElementById("authPassword").value;
      await signup(email, password);
      authModal.classList.remove("show");
    });

    // ----------------------------
    // BUY TOKENS BUTTON
    // ----------------------------
    buyTokensBtn.addEventListener("click", () => {
      buyModal.classList.add("show");
    });
    closeModal.addEventListener("click", () => {
      buyModal.classList.remove("show");
    });

    // ----------------------------
    // THEME TOGGLE
    // ----------------------------
    const themeToggle = document.getElementById("themeToggle");
    themeToggle.addEventListener("click", () => {
      document.body.classList.toggle("light");
    });

    // ----------------------------
    // PARTICLE BACKGROUND
    // ----------------------------
    const particleContainer = document.getElementById("particle-container");
    for(let i=0; i<50; i++){
      const p = document.createElement("div");
      p.className = "particle";
      p.style.left = Math.random()*100 + "vw";
      p.style.animationDuration = 5+Math.random()*5 + "s";
      p.style.width = p.style.height = 2+Math.random()*4 + "px";
      particleContainer.appendChild(p);
    }
  </script>
</head>
<body>

  <!-- PARTICLE BACKGROUND -->
  <div id="particle-container"></div>

  <!-- NAVBAR -->
  <nav class="navbar">
    <h2 class="logo">ðŸŽ® gn-sci</h2>
    <div class="nav-right">
      <div class="token-display" id="tokenDisplay">
        ðŸª™ <span id="tokenAmount">0</span>
        <button class="token-plus" id="buyTokensBtn">+</button>
      </div>
      <button class="theme-toggle" id="themeToggle">ðŸŒ™</button>
    </div>
  </nav>

  <!-- HEADER -->
  <header>
    <h1>Welcome to <span class="highlight">gn-sci</span>!</h1>
    <h3>Last updated: Jan 30, 2026</h3>
    <br>
    <button onclick="authModal.classList.add('show')">Login / Sign Up</button>
    <br><br>
    <a href="https://discord.gg/RmUqgTDccE">Join the Discord!</a>
  </header>

  <!-- SEARCH BAR -->
  <input type="text" class="search-bar" placeholder="Search any game..." id="searchInput">

  <!-- GAME LIST -->
  <main>
    <section class="game-list" id="gameList">
      <!-- Add your games here as before -->
    </section>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>&copy; 2025 The gn-sci Foundation. All rights reserved.</p>
  </footer>

  <!-- BUY TOKENS MODAL -->
  <div class="modal" id="buyModal">
    <div class="modal-content">
      <h2>Buy Tokens</h2>
      <p>Token packages coming soon.</p>
      <button id="closeModal">Close</button>
    </div>
  </div>

  <!-- AUTH MODAL -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <h2>Login / Sign Up</h2>
      <input type="email" id="authEmail" placeholder="Email"><br><br>
      <input type="password" id="authPassword" placeholder="Password"><br><br>
      <button id="loginBtn">Login</button>
      <button id="signupBtn">Sign Up</button>
    </div>
  </div>

</body>
</html>
